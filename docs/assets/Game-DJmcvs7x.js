import{_ as Z,r as d,i as ee,c as f,h as v,j as _,f as g,t as p,F as N,k as T,w as te,n as ne,l as le}from"./index-CPr-TiJ5.js";function q(E=440,b=200,y=.1){const r=new(window.AudioContext||window.webkitAudioContext),i=r.createOscillator(),c=r.createGain();i.frequency.value=E,i.type="square",c.gain.value=y,i.connect(c),c.connect(r.destination),i.start(),setTimeout(()=>{i.stop(),r.close()},b)}const oe={class:"minesweeper-container"},ae={key:0,class:"overlay"},se={class:"popup"},re={class:"status-bar"},ue={class:"grid"},ie=["onClick","onContextmenu"],ce={key:1},fe={key:2},ve={key:3,class:"item-icon fading"},de={key:4},ge={key:1,class:"toolbar"},me=["onClick"],he={key:2},pe={key:3},ye={__name:"Game",setup(E){const b={easy:{width:9,height:9,mines:10},medium:{width:16,height:16,mines:40},hard:{width:30,height:16,mines:99}},y=d(null),r=d([]),i=d(0),c=d(0),I=d(0),m=d(!1),k=d(!1),A=d(!1),$=d(0),x=d(0),h=d([]);let B=null;function F(a){M(),y.value=a;const t=b[a];i.value=t.width,c.value=t.height,I.value=t.mines,x.value=I.value,$.value=0,A.value=!1,m.value=!1,k.value=!1,r.value=Array.from({length:c.value},()=>Array.from({length:i.value},()=>({revealed:!1,flagged:!1,mine:!1,count:0,item:null}))),console.log("生成地图完成:",r.value)}function z(a,t){var n;const e=[];for(let o=0;o<c.value;o++){e[o]=[];for(let s=0;s<i.value;s++)e[o][s]={revealed:!1,flagged:!1,mine:!1,count:0,item:null}}let l=0;for(;l<I.value;){const o=Math.floor(Math.random()*i.value),s=Math.floor(Math.random()*c.value),u=Math.abs(o-a)<=1&&Math.abs(s-t)<=1;!e[s][o].mine&&!u&&(e[s][o].mine=!0,l++)}for(let o=0;o<c.value;o++)for(let s=0;s<i.value;s++)e[o][s].mine||(e[o][s].count=O(e,s,o));return console.log("生成地图完成:",e.length,(n=e[0])==null?void 0:n.length),e}function O(a,t,e){let l=0;for(let n=-1;n<=1;n++)for(let o=-1;o<=1;o++){const s=t+o,u=e+n;s>=0&&u>=0&&s<i.value&&u<c.value&&a[u][s].mine&&l++}return l}function R(a,t){var l,n,o;if(m.value||(n=(l=r.value[t])==null?void 0:l[a])!=null&&n.flagged)return;A.value||(r.value=z(a,t),A.value=!0,X());const e=(o=r.value[t])==null?void 0:o[a];e.revealed?e.count>0&&(P(a,t),S()):(C(a,t),S())}function G(a,t){if(m.value||r.value[t][a].revealed)return;const e=r.value[t][a];e.flagged=!e.flagged,x.value+=e.flagged?-1:1,q(660,80,.1)}function C(a,t){const e=r.value[t][a];if(!(e.revealed||e.flagged)){if(e.revealed=!0,e.mine){m.value=!0,q(120,400,.1),M(),H();return}if(e.count===0&&!e.item&&Math.random()<.1){const l=["flag","reveal","robot"];e.item=l[Math.floor(Math.random()*l.length)],e.itemFade=!0,h.value.push(e.item),setTimeout(()=>{e.itemFade=!1},2e3)}e.count===0&&U(a,t)}}function U(a,t){for(let e=-1;e<=1;e++)for(let l=-1;l<=1;l++){const n=a+l,o=t+e;n>=0&&o>=0&&n<i.value&&o<c.value&&C(n,o)}}function V(a,t){let e=0;for(let l=-1;l<=1;l++)for(let n=-1;n<=1;n++){const o=a+n,s=t+l;if(o>=0&&s>=0&&o<i.value&&s<c.value){const u=r.value[s][o];!u.revealed&&!u.flagged&&e++}}return e}function W(a){const t=[0,0,0],e=[255,0,0],n=Math.min(a/5,1),o=Math.floor(t[0]+(e[0]-t[0])*n),s=Math.floor(t[1]+(e[1]-t[1])*n),u=Math.floor(t[2]+(e[2]-t[2])*n);return`rgb(${o},${s},${u})`}function D(){console.log("机器人尝试点击");for(let a=0;a<c.value;a++)for(let t=0;t<i.value;t++){const e=r.value[a][t];if(e.revealed&&e.count>0){let l=0,n=[];for(let o=-1;o<=1;o++)for(let s=-1;s<=1;s++){const u=t+s,w=a+o;if(u>=0&&w>=0&&u<i.value&&w<c.value){const j=r.value[w][u];j.flagged?l++:j.revealed||n.push({x:u,y:w})}}if(l+n.length===e.count&&n.length>0){const{x:o,y:s}=n[Math.floor(Math.random()*n.length)];return G(o,s),console.log("机器人尝试成功"),!0}}}return console.log("机器人尝试失败"),!1}function P(a,t){const e=r.value[t][a];let l=0;for(let n=-1;n<=1;n++)for(let o=-1;o<=1;o++){const s=a+o,u=t+n;s>=0&&u>=0&&s<i.value&&u<c.value&&r.value[u][s].flagged&&l++}if(l===e.count)for(let n=-1;n<=1;n++)for(let o=-1;o<=1;o++){const s=a+o,u=t+n;s>=0&&u>=0&&s<i.value&&u<c.value&&!r.value[u][s].flagged&&!r.value[u][s].revealed&&C(s,u)}}function H(){for(let a of r.value)for(let t of a)t.revealed=!0}function L(a){switch(a){case"flag":return"🎯";case"reveal":return"🌟";case"robot":return"🤖";default:return"❓"}}function J(a){switch(a){case"flag":return"地雷自動マーク";case"reveal":return"安全エリア展開";case"robot":return"ロボット補助";default:return"不明"}}function K(a){if(a==="flag"){const t=[];for(let e=0;e<c.value;e++)for(let l=0;l<i.value;l++){const n=r.value[e][l];n.mine&&!n.flagged&&t.push({x:l,y:e})}if(t.length>0){const{x:e,y:l}=t[Math.floor(Math.random()*t.length)];r.value[l][e].flagged=!0,x.value--}}else if(a==="reveal"){const t=[];for(let e=0;e<c.value;e++)for(let l=0;l<i.value;l++){const n=r.value[e][l];!n.mine&&!n.revealed&&n.count===0&&t.push({x:l,y:e})}if(t.length>0){const{x:e,y:l}=t[Math.floor(Math.random()*t.length)];C(e,l)}}else if(a==="robot"){let t=0;const e=10,l=setInterval(()=>{const n=D();t++,(!n||t>=e||m.value||k.value)&&clearInterval(l)},1e3)}}function Q(a){const t=h.value[a];K(t),h.value.splice(a,1)}function S(){for(let a of r.value)for(let t of a)if(!t.mine&&!t.revealed)return;k.value=!0,M()}function X(){B=setInterval(()=>$.value++,1e3)}function M(){B&&clearInterval(B)}function Y(){y.value=null,h.value=[]}return ee(M),(a,t)=>(v(),f("div",oe,[y.value?_("",!0):(v(),f("div",ae,[g("div",se,[t[3]||(t[3]=g("h3",null,"難易度を選択",-1)),g("button",{onClick:t[0]||(t[0]=e=>F("easy"))},"初級"),g("button",{onClick:t[1]||(t[1]=e=>F("medium"))},"中級"),g("button",{onClick:t[2]||(t[2]=e=>F("hard"))},"上級")])])),t[4]||(t[4]=g("h2",null,"マインスイーパー",-1)),g("div",re,[g("span",null,"経過時間："+p($.value)+"秒",1),g("span",null,"残り旗："+p(x.value),1)]),g("div",ue,[(v(!0),f(N,null,T(r.value,(e,l)=>(v(),f("div",{key:l,class:"row"},[(v(!0),f(N,null,T(e,(n,o)=>(v(),f("div",{key:o,class:ne(["cell",{revealed:n.revealed,mine:n.revealed&&n.mine,flagged:n.flagged}]),onClick:s=>R(o,l),onContextmenu:te(s=>G(o,l),["prevent"])},[n.revealed&&!n.mine&&n.count>0?(v(),f("span",{key:0,style:le({color:W(V(o,l))})},p(n.count),5)):n.revealed&&n.mine?(v(),f("span",ce,"💣")):!n.revealed&&n.flagged?(v(),f("span",fe,"🚩")):_("",!0),n.itemFade?(v(),f("span",ve,p(L(n.item)),1)):(v(),f("span",de," "))],42,ie))),128))]))),128))]),h.value.length?(v(),f("div",ge,[(v(!0),f(N,null,T(h.value,(e,l)=>(v(),f("span",{key:l,class:"tool",onClick:n=>Q(l)},p(L(e))+" "+p(J(e)),9,me))),128))])):_("",!0),m.value?(v(),f("p",he,"💥 ゲームオーバー！")):k.value?(v(),f("p",pe,"🎉 クリア！")):_("",!0),m.value||k.value?(v(),f("button",{key:4,onClick:Y},"再プレイ")):_("",!0)]))}},_e=Z(ye,[["__scopeId","data-v-3f5382d6"]]);export{_e as default};
