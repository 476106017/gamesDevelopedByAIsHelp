import{m as Ie,r as H,p as ne,o as Ze,q as Ue,s as Ve,c as $,h as A,f as x,w as Je,t as k,g as oe,l as we,F as V,k as J,n as ke,j as ie}from"./index-Cy8pY4vG.js";const N=[{id:"apple",emoji:"🍎",name:"苹果",buyPrice:5,sellPrice:8,weight:2,boxSize:20,transportTime:5e3,demand:2.1},{id:"banana",emoji:"🍌",name:"香蕉",buyPrice:4,sellPrice:7,weight:1,boxSize:25,transportTime:1e3,demand:4.3},{id:"watermelon",emoji:"🍉",name:"西瓜",buyPrice:10,sellPrice:16,weight:8,boxSize:10,transportTime:7e3,demand:1.9},{id:"grape",emoji:"🍇",name:"葡萄",buyPrice:6,sellPrice:10,weight:1,boxSize:25,transportTime:3e3,demand:1.3},{id:"melon",emoji:"🍈",name:"香瓜",buyPrice:7,sellPrice:11,weight:5,boxSize:12,transportTime:4e3,demand:1},{id:"strawberry",emoji:"🍓",name:"草莓",buyPrice:6,sellPrice:9,weight:1,boxSize:20,transportTime:3e3,demand:1.5},{id:"peach",emoji:"🍑",name:"桃子",buyPrice:7,sellPrice:10,weight:3,boxSize:18,transportTime:4e3,demand:1.2},{id:"mango",emoji:"🥭",name:"芒果",buyPrice:8,sellPrice:13,weight:4,boxSize:15,transportTime:4e3,demand:1.1},{id:"lemon",emoji:"🍋",name:"柠檬",buyPrice:4,sellPrice:7,weight:1,boxSize:20,transportTime:2e3,demand:1.3},{id:"kiwi",emoji:"🥝",name:"猕猴桃",buyPrice:7,sellPrice:11,weight:2,boxSize:20,transportTime:3500,demand:.2},{id:"pineapple",emoji:"🍍",name:"菠萝",buyPrice:9,sellPrice:14,weight:6,boxSize:8,transportTime:5e3,demand:.9},{id:"cherry",emoji:"🍒",name:"樱桃",buyPrice:10,sellPrice:16,weight:1,boxSize:30,transportTime:6e3,demand:1.6},{id:"pear",emoji:"🍐",name:"梨子",buyPrice:6,sellPrice:9,weight:2,boxSize:20,transportTime:3e3,demand:1.2},{id:"hamburger",emoji:"🍔",name:"汉堡",buyPrice:8,sellPrice:13,weight:1,boxSize:25,transportTime:4500,demand:1.4},{id:"avocado",emoji:"🥑",name:"牛油果",buyPrice:9,sellPrice:14,weight:5,boxSize:10,transportTime:5e3,demand:.8},{id:"greenapple",emoji:"🍏",name:"青苹果",buyPrice:5,sellPrice:8,weight:2,boxSize:20,transportTime:5e3,demand:1},{id:"tangerine",emoji:"🍊",name:"橘子",buyPrice:5,sellPrice:9,weight:2,boxSize:20,transportTime:3e3,demand:2.3},{id:"coconut",emoji:"🥥",name:"椰子",buyPrice:10,sellPrice:15,weight:6,boxSize:6,transportTime:6e3,demand:.7},{id:"corn",emoji:"🌽",name:"玉米",buyPrice:11,sellPrice:17,weight:7,boxSize:5,transportTime:7e3,demand:.6},{id:"bread",emoji:"🍞",name:"面包",buyPrice:7,sellPrice:12,weight:3,boxSize:18,transportTime:4500,demand:3}],O=Ie({money:2e3,carryingCapacity:50,incomingShipments:[],workerSpeed:3}),R=Ie({level:1,exp:0}),le=1,G=0,ve=2,ce=3;function Ke(r,u){const T=N.slice(0,R.level+2);for(let w=0;w<u.length;w++)for(let d=0;d<u[0].length;d++)if(u[w][d]===1&&Math.random()<.05){const b=T[Math.floor(Math.random()*T.length)];r[w][d]={type:"goods",productId:b.id,count:Math.floor(b.boxSize*(Math.random()*.5+.5))}}}function Qe(r,u){const T=Array.from({length:r},()=>Array(u).fill(G)),w=4,d=2,b=1,h=4;for(let p=0;p<w;p++){const c=h+p*(d+b);for(let e=c;e<c+d;e++)for(let i=1;i<=10;i++)T[e][i]=le;for(let e=c;e<c+d;e++)for(let i=15;i<=24;i++)T[e][i]=le;for(let e=c;e<c+d;e++)for(let i=u-11;i<=u-2;i++)T[e][i]=le;for(let e=18;e<=21;e++)T[0][e]=ve;for(let e=18;e<=21;e++)T[r-1][e]=ce}return T}function et(r,u,T){const w=N.find(h=>h.id===r);if(!w)return{error:"商品不存在"};const d=w.buyPrice*w.boxSize*u;if(T<u)return{error:"入库区空间不足"};if(O.money<d)return{error:"资金不足"};O.money-=d;const b=Date.now()+w.transportTime;return O.incomingShipments.push({productId:r,boxCount:u,eta:b,startTime:Date.now()}),{success:!0}}function tt(r,u,T,w=[]){const d=Date.now(),b=[];for(const h of O.incomingShipments)if(h.eta<=d){let p=!1;w.includes("direct-out")&&(p=Se(r,u,ce,h.productId,h.boxCount)),p||(p=Se(r,u,T,h.productId,h.boxCount)),p||alert("入库失败，空间不足")}else b.push(h);O.incomingShipments=b}function Se(r,u,T,w,d){const b=N.find(p=>p.id===w);if(!b)return!1;let h=0;for(let p=0;p<r.length;p++)for(let c=0;c<r[0].length;c++){if(h>=d)return!0;const e=u[p][c],i=r[p][c];e===T&&i===null&&(r[p][c]={type:"goods",productId:w,count:b.boxSize},h++)}return h===d}function nt(r,u,T){let w=0;for(let d=0;d<r.length;d++)for(let b=0;b<r[0].length;b++)u[d][b]===T&&r[d][b]===null&&w++;return w}function ot(r){return r.map(u=>({v:u,sort:Math.random()})).sort((u,T)=>u.sort-T.sort).map(({v:u})=>u)}let Pe=1;function lt(){const u=`ORD-${new Date().toISOString().slice(0,10).replace(/-/g,"")}-${String(Pe).padStart(3,"0")}`;return Pe++,u}function Me(){const r=Math.floor(Math.random()*3)+1,T=N.slice(0,R.level+2).flatMap(b=>Array(Math.floor(b.demand*10)).fill(b)),d=[...new Set(ot(T))].slice(0,r).map(b=>{const h=Math.ceil(Math.random()*b.boxSize);return{productId:b.id,count:h}});return{id:lt(),items:d,expires:Date.now()+18e4}}function at(r,u,T,w=[]){const d=w.includes("auto-banana"),b={};for(let c=0;c<u.length;c++)for(let e=0;e<u[0].length;e++)if(T[c][e]===ce){const i=u[c][e];if(i&&i.type==="goods"){const S=i.productId;b[S]=(b[S]||0)+i.count}}for(const c of r.items){const e=c.productId==="banana",i=b[c.productId]||0;if((!e||!d)&&i<c.count)return{success:!1,reason:"库存不足"}}for(const c of r.items){if(c.productId==="banana"&&d)continue;let i=c.count;for(let S=0;S<u.length;S++){for(let C=0;C<u[0].length;C++)if(T[S][C]===ce){const Y=u[S][C];if(Y&&Y.type==="goods"&&Y.productId===c.productId){const z=Math.min(i,Y.count);if(Y.count-=z,i-=z,Y.count<=0&&(u[S][C]=null),i<=0)break}}if(i<=0)break}}const h=r.items.reduce((c,e)=>{const i=N.find(S=>S.id===e.productId);return c+((i==null?void 0:i.sellPrice)||0)*e.count},0),p=Math.floor(r.items.reduce((c,e)=>{var S;const i=((S=N.find(C=>C.id===e.productId))==null?void 0:S.demand)||1;return c+1/i*10},0)+Math.random()*10);return O.money+=h+p,{success:!0,earned:h,bonus:p,total:h+p}}function st(r,u,T,w,d,b,h,p,c){for(let e=0;e<b;e++)for(let i=0;i<h;i++){const S=(i-w.x)*d,C=(e-w.y)*d;if(S+d<0||S>p||C+d<0||C>c)continue;const Y=u[e][i],z=T[e][i];switch(Y){case 1:r.fillStyle="#888";break;case 2:r.fillStyle="#aaf";break;case 3:r.fillStyle="#afa";break;default:r.fillStyle="#f0f0f0";break}if(r.fillRect(S,C,d,d),r.strokeStyle="#ccc",r.strokeRect(S,C,d,d),(z==null?void 0:z.type)==="goods"){const ae=N.find(E=>E.id===z.productId);if(ae&&(r.font=`${d*.6}px serif`,r.textAlign="center",r.textBaseline="middle",r.fillText(ae.emoji,S+d*.5,C+d*.5),r.font="12px sans-serif",r.textAlign="right",r.textBaseline="bottom",r.fillStyle="#fff",r.fillRect(S+d-28,C+d-18,26,16),r.fillStyle="#000",r.fillText(`×${z.count}`,S+d-4,C+d-4),z.growthAnim)){const E=Date.now()-z.growthAnim.start,K=800;if(E<K){const W=E/K,Q=20*W,L=1-W,se=1+W;r.save(),r.globalAlpha=L,r.font=`${12*se}px sans-serif`,r.fillStyle="darkgreen",r.textAlign="right",r.fillText("+1",S+d-4,C+12-Q),r.restore()}else delete z.growthAnim}}}}const re=[{level:1,expNeeded:100,expTotal:100},{level:2,expNeeded:120,expTotal:220},{level:3,expNeeded:144,expTotal:364},{level:4,expNeeded:172,expTotal:536},{level:5,expNeeded:207,expTotal:743},{level:6,expNeeded:248,expTotal:991},{level:7,expNeeded:298,expTotal:1289},{level:8,expNeeded:358,expTotal:1647},{level:9,expNeeded:429,expTotal:2076},{level:10,expNeeded:515,expTotal:2591},{level:11,expNeeded:619,expTotal:3210},{level:12,expNeeded:743,expTotal:3953},{level:13,expNeeded:891,expTotal:4844},{level:14,expNeeded:1069,expTotal:5913},{level:15,expNeeded:1283,expTotal:7196},{level:16,expNeeded:1540,expTotal:8736},{level:17,expNeeded:1848,expTotal:10584},{level:18,expNeeded:2218,expTotal:12802},{level:19,expNeeded:2662,expTotal:15464},{level:20,expNeeded:3194,expTotal:18658}],it={class:"sidebar"},rt={class:"level-bar"},ct={class:"money-display"},ut={class:"tabs"},dt=["onClick"],ft={class:"sidebar-content"},vt={key:0,style:{padding:"16px"}},pt={key:0,class:"product-line"},mt=["title"],gt={class:"name"},ht={class:"note"},yt=["onClick"],xt={key:1,class:"locked"},bt={key:1,style:{padding:"16px"}},_t={class:"order-header"},Tt={class:"order-items"},wt={class:"order-bonus"},kt={class:"order-total"},St=["onClick"],Pt={class:"progress-bar"},Mt={key:2,style:{padding:"16px"}},It=["title"],Ct={class:"emoji"},jt={class:"count-overlay"},Nt={class:"name"},$t={class:"value"},At={class:"inventory-total"},zt={key:3,class:"skill-panel"},Dt={class:"skill-text"},Rt={class:"skill-name"},Bt={class:"skill-desc"},Ot=["disabled","onClick"],j=40,X=20,q=40,Wt={__name:"Game",setup(r){const u=H(null);let T=800,w=512,d=0,b=0;const h=H({x:0,y:0}),p=H(Qe(X,q)),c=H(Array.from({length:X},()=>Array(q).fill(null))),e=H({gx:6,gy:6,px:0,py:0,path:[],carrying:null,target:null,message:null,messageType:"error",messageTimer:0});let i=null,S=null,C=0,Y=0;const z=H(null),ae=["入库","出库","库存","技能"],E=H("入库"),K=[{id:"auto-banana",name:"🍌香蕉豁免",description:"完成订单时无视香蕉条件",cost:500},{id:"direct-out",name:"📦入即出",description:"允许商品入库到出库区",cost:800},{id:"shelf-grow",name:"🌱富营养货架",description:"让货架上的商品肆意生长！",cost:2e3}],W=H([]),Q=H(O.money);ne(()=>N.slice(0,R.level+2));const L=H([]),se=ne(()=>{const t=re.find(o=>o.level===R.level);return(t==null?void 0:t.expNeeded)||99999}),Ce=ne(()=>Math.min(100,R.exp/se.value*100));function je(t){for(R.exp+=t;R.level<re.length&&R.exp>=re[R.level-1].expNeeded;)R.exp-=re[R.level-1].expNeeded,R.level++,O.workerSpeed+=1,U("Level up！","success")}function pe(){const n=3e4*Math.exp(-.15*(R.level-1));return Math.max(1e3,Math.floor(n))}function Ne(t){const o=K.find(n=>n.id===t);o&&O.money>=o.cost&&!W.value.includes(t)&&(O.money-=o.cost,W.value.push(t))}function ee(t){return N.find(o=>o.id===t)||{}}function me(t){const n=t.items.reduce((a,s)=>{const f=ee(s.productId).demand||1;return a+Math.floor(1/f*10)},0),l=t.items.length*5;return 5+n+l}function $e(t){return t.items.reduce((n,l)=>{const a=ee(l.productId).sellPrice||0;return n+l.count*a},0)+me(t)}function Ae(t){const n=t.expires-Date.now();return 100-Math.min(100,Math.max(0,(18e4-n)/18e4*100))}const ze=ne(()=>Object.values(ge.value).reduce((t,o)=>t+o.value,0));function De(){function t(){const o=Me();L.value.push(o);const n=Math.floor(Math.random()*1e4)+pe();setTimeout(t,n)}L.value=[Me()],setTimeout(t,pe())}setInterval(()=>{const t=Date.now();L.value=L.value.filter(o=>o.expires>t)},1e3);const ge=ne(()=>{const t={};for(let o of c.value)for(let n of o)if(Z(n)){const l=N.find(s=>s.id===n.productId);if(!l)continue;const a=n.count;t[l.id]?(t[l.id].count+=a,t[l.id].value+=a*l.sellPrice):t[l.id]={count:a,emoji:l.emoji,name:l.name,value:a*l.sellPrice}}return t});function he(t){const o=N.find(n=>n.name===t);return o?`名称: ${o.name}
  每箱: ${o.boxSize}个
  重量: ${o.weight}
  进价: ¥${o.buyPrice}
  售价: ¥${o.sellPrice}
  运输: ${o.transportTime/1e3}s
  需求指数: ${o.demand}`:""}function Re(t){const o=nt(c.value,p.value,ve),n=et(t,1,o);n.error&&alert(n.error)}function Be(){const t=d/2,o=b/2,n=e.value.gx,l=e.value.gy;let a=n-t,s=l-o;a<0&&(a=0),a>q-d&&(a=q-d),s<0&&(s=0),s>X-b&&(s=X-b);const f=(m,v,g)=>m+(v-m)*g,y=.1;h.value.x=f(h.value.x,a,y),h.value.y=f(h.value.y,s,y)}function Oe(){const t=e.value.px-h.value.x*j,o=e.value.py-h.value.y*j;if(i.font=`${j*.9}px serif`,i.textAlign="center",i.textBaseline="middle",i.fillText("👷",t,o),e.value.message&&e.value.messageTimer>0&&(He(i,e.value.message,t,o,e.value.messageType),e.value.messageTimer--,e.value.messageTimer===0&&(e.value.message=null)),e.value.carrying){const n=N.find(l=>l.id===e.value.carrying.productId);n&&(i.font="20px serif",i.fillText(n.emoji,t,o+14),i.fillStyle="#fff",i.fillRect(t+10,o+15,26,14),i.font="10px sans-serif",i.fillStyle="#000",i.fillText(`×${e.value.carrying.count}`,t+22,o+24))}}function Ye(){const t=Date.now(),o=120,n=16;O.incomingShipments.forEach((l,a)=>{const s=N.find(_=>_.id===l.productId);if(!s)return;const f=l.eta-(l.startTime||l.eta-s.transportTime),m=1-(l.eta-t)/f,v=T-150,g=30+a*(n+10);i.fillStyle="#ddd",i.fillRect(v,g,o,n),i.fillStyle="#76c7c0",i.fillRect(v,g,o*m,n),i.font="16px serif",i.fillStyle="#000",i.fillText(s.emoji+" ×"+l.boxCount,v-80,g+14)})}let ue=0;function ye(){var t;if(i.clearRect(0,0,u.value.width,u.value.height),st(i,p.value,c.value,h.value,j,X,q,T,w),Ee(),Be(),Oe(),Ye(),tt(c.value,p.value,ve,W.value),ue++,ue>=60&&(ue=0,W.value.includes("shelf-grow")&&We()),S=requestAnimationFrame(ye),e.value.target){const[o,n]=e.value.target,l=(t=c.value[n])==null?void 0:t[o],a=e.value.__targetMode,s=e.value.carrying;if(a==="pickup"){if(!Z(l)){e.value.target=null;return}if(e.value.__tick||(e.value.__tick=0),e.value.__tick++,e.value.__tick>=5){const f=l.productId;N.find(m=>m.id===f)&&(s?s.count++:e.value.carrying={productId:f,count:1},l.count--,l.count<=0&&(c.value[n][o]=null,e.value.target=null)),e.value.__tick=0}}else if(a==="dropoff"){if(!s){e.value.target=null;return}const f=N.find(y=>y.id===s.productId);if(!f)return;if(e.value.__tick||(e.value.__tick=0),e.value.__tick++,e.value.__tick>=5){if(Z(l)){if(l.productId!==s.productId){U("商品类型不一致"),e.value.target=null;return}if(l.count>=f.boxSize){U("此格已满"),e.value.target=null;return}l.count++}else c.value[n][o]={type:"goods",productId:s.productId,count:1};s.count--,s.count<=0&&(e.value.carrying=null,e.value.target=null),e.value.__tick=0}}}if(z.value){const{x:o,y:n,productId:l}=z.value,a=N.find(s=>s.id===l);if(a){const f=`
      ${a.name}
      进价: ¥${a.buyPrice}
      售价: ¥${a.sellPrice}
      重量: ${a.weight}
      `.split(`
`),y=f.length*18+10;i.fillStyle="rgba(0,0,0,0.75)",i.fillRect(o+10,n+10,80,y),i.fillStyle="#fff",i.font="13px sans-serif",f.forEach((m,v)=>{i.fillText(m,o+36,n+28+v*16)})}}}function We(){for(let t=0;t<c.value.length;t++)for(let o=0;o<c.value[0].length;o++){const n=p.value[t][o],l=c.value[t][o];if(n===le&&l&&l.type==="goods"){const a=N.find(f=>f.id===l.productId);if(!a)continue;const s=a.boxSize;if(Math.random()<l.count*.01&&(l.count++,l.growthAnim={start:Date.now()},l.count>s)){const f=[[1,0],[-1,0],[0,1],[0,-1]];for(const[y,m]of f){const v=o+y,g=t+m;if(v<0||g<0||v>=c.value[0].length||g>=c.value.length)continue;const _=c.value[g][v];if(p.value[g][v]===le)if(_){if(_.type==="goods"&&_.productId===l.productId&&_.count<s){_.count++,_.growthAnim={start:Date.now()},l.count--;break}}else{c.value[g][v]={type:"goods",productId:l.productId,count:1,growthAnim:{start:Date.now()}},l.count--;break}}l.count>s&&(l.count=s)}}}}function xe(){var m;const{gx:t,gy:o}=e.value,n=e.value.__targetGoods;if(!n)return;const[l,a]=n,s=Math.abs(t-l),f=Math.abs(o-a),y=(m=c.value[a])==null?void 0:m[l];(s===1&&f===0||s===0&&f===1)&&(e.value.__targetMode==="pickup"&&Z(y)&&y.count>0&&(e.value.target=[l,a],e.value.__tick=0),e.value.__targetMode==="dropoff"&&e.value.carrying&&(e.value.target=[l,a],e.value.__tick=0)),console.log("afterArrivedTile",e.value.target,e.value.__targetGoods,e.value.carrying),e.value.__targetGoods=null}function Ee(){const t=O.workerSpeed;if(e.value.path.length>0){const[o,n]=e.value.path[0],l=o*j+j/2,a=n*j+j/2,s=l-e.value.px,f=a-e.value.py,y=Math.sqrt(s*s+f*f);if(y<t){if(e.value.px=l,e.value.py=a,e.value.gx=o,e.value.gy=n,e.value.gx<0||e.value.gy<0||e.value.gx>=q||e.value.gy>=X){console.warn("工人越界:",e.value.gx,e.value.gy),e.value.path=[];return}e.value.path.shift(),xe()}else e.value.px+=s/y*t,e.value.py+=f/y*t}}function Xe(t){const o=at(t,c.value,p.value,W.value);o.success?(L.value=L.value.filter(n=>n.id!==t.id),je(o.total)):U("尚未满足订单条件！")}function be(t,o,n){const a=[[t+1,o],[t-1,o],[t,o+1],[t,o-1]].filter(([v,g])=>v>=0&&g>=0&&v<q&&g<X&&p.value[g][v]===G),{gx:s,gy:f}=e.value;for(const[v,g]of a)if(v===s&&g===f){e.value.__targetGoods=[t,o],e.value.__targetMode=n,e.value.path=[],xe(),console.log(e.value.__targetGoods,e.value.__targetMode,e.value.path);return}let y=null,m=[];for(const[v,g]of a){const _=fe([e.value.gx,e.value.gy],[v,g]);_.length&&(!y||_.length<m.length)&&(y=[v,g],m=_)}e.value.__targetGoods=[t,o],e.value.__targetMode=n,y&&m&&(e.value.path=m)}function de(t){var _,P;const o=u.value.getBoundingClientRect(),n=t.clientX-o.left,l=t.clientY-o.top,a=Math.floor(n/j+h.value.x),s=Math.floor(l/j+h.value.y);if(a<0||s<0||a>=q||s>=X){console.warn("工人越界:",a,s);return}let f=a,y=s;if(((_=p.value[s])==null?void 0:_[a])!==G){const M=[[a+1,s],[a-1,s],[a,s+1],[a,s-1]];let I=null,F=[];for(const[B,D]of M)if(B>=0&&D>=0&&B<q&&D<X&&p.value[D][B]===G){const te=fe([e.value.gx,e.value.gy],[B,D]);te.length&&(!I||te.length<F.length)&&(I=[B,D],F=te)}I?(f=I[0],y=I[1]):console.warn("没有可达路径")}e.value.target=null;const m=(P=c.value[s])==null?void 0:P[a],v=e.value.carrying;if(Z(m)){console.warn("isGoodsCell",v),!v||v.productId===m.productId?be(a,s,"pickup"):U("商品类型不一致");return}const g=fe([e.value.gx,e.value.gy],[f,y]);g.length>0&&(e.value.path=g)}function qe(t){var g,_;t.preventDefault();const o=u.value.getBoundingClientRect(),n=t.clientX-o.left,l=t.clientY-o.top,a=Math.floor(n/j+h.value.x),s=Math.floor(l/j+h.value.y);if(a<0||s<0||a>=q||s>=X){console.warn("工人越界:",a,s);return}const f=(g=p.value[s])==null?void 0:g[a],y=(_=c.value[s])==null?void 0:_[a],m=e.value.carrying;if(f===G||!m)return;if(!(y==null||y.type==="goods"&&y.productId===m.productId)){U("商品类型不一致");return}be(a,s,"dropoff")}function Fe(t){var s;const o=u.value.getBoundingClientRect();C=t.clientX-o.left,Y=t.clientY-o.top;const n=Math.floor(C/j+h.value.x),l=Math.floor(Y/j+h.value.y),a=(s=c.value[l])==null?void 0:s[n];Z(a)?z.value={x:C,y:Y,productId:a.productId}:z.value=null}function fe(t,o){const[n,l]=t,[a,s]=o,f=[[n,l]],y={},m={},v=(P,M)=>`${P},${M}`;for(y[v(n,l)]=null,m[v(n,l)]=0;f.length;){f.sort((I,F)=>m[v(I[0],I[1])]+_e(I,o)-(m[v(F[0],F[1])]+_e(F,o)));const[P,M]=f.shift();if(P===a&&M===s)break;for(const[I,F]of[[1,0],[-1,0],[0,1],[0,-1],[1,1],[-1,1],[1,-1],[-1,-1]]){const B=P+I,D=M+F;if(B<0||D<0||B>=q||D>=X||p.value[D][B]!==G)continue;if(Math.abs(I)+Math.abs(F)===2){const Le=p.value[M][D]!==G,Ge=p.value[D][P]!==G;if(Le||Ge)continue}const te=I===0||F===0?1:1.4,Te=m[v(P,M)]+te;(!(v(B,D)in m)||Te<m[v(B,D)])&&(m[v(B,D)]=Te,y[v(B,D)]=[P,M],f.push([B,D]))}}const g=[];let _=[a,s];for(;_&&v(_[0],_[1])!==v(n,l);)g.unshift(_),_=y[v(_[0],_[1])];return g}function _e(t,o){return Math.abs(t[0]-o[0])+Math.abs(t[1]-o[1])}function Z(t){return t&&typeof t=="object"&&t.type==="goods"}function U(t,o="error",n=60){e.value.message=t,e.value.messageTimer=n,e.value.messageType=o}function He(t,o,n,l,a="error"){const m=`${a==="success"?"😄":"❌"} ${o}`;t.font="14px sans-serif";const g=t.measureText(m).width+8*2,_=22,P=n-g/2,M=l-60,I=6;t.beginPath(),t.moveTo(P+I,M),t.lineTo(P+g-I,M),t.quadraticCurveTo(P+g,M,P+g,M+I),t.lineTo(P+g,M+_-I),t.quadraticCurveTo(P+g,M+_,P+g-I,M+_),t.lineTo(P+I,M+_),t.quadraticCurveTo(P,M+_,P,M+_-I),t.lineTo(P,M+I),t.quadraticCurveTo(P,M,P+I,M),t.closePath(),t.fillStyle=a==="success"?"rgba(240,255,240,0.95)":"rgba(255,255,255,0.95)",t.fill(),t.strokeStyle=a==="success"?"#4caf50":"#999",t.stroke(),t.fillStyle="#000",t.textAlign="center",t.textBaseline="middle",t.fillText(m,n,M+_/2)}return Ze(()=>{T=window.innerWidth-500,w=window.innerHeight-100,u.value.width=T,u.value.height=w,d=Math.floor(T/j),b=Math.floor(w/j),i=u.value.getContext("2d"),e.value.px=e.value.gx*j+j/2,e.value.py=e.value.gy*j+j/2,u.value.addEventListener("click",de),Ke(c.value,p.value),ye(),De()}),Ue(()=>{cancelAnimationFrame(S),u.value.removeEventListener("click",de)}),Ve(()=>O.money,(t,o)=>{const a=16.666666666666668,s=(t-o)/30;let f=o,y=0;const m=setInterval(()=>{f+=s,Q.value=Math.round(f),y++,y>=30&&(Q.value=t,clearInterval(m))},a)}),(t,o)=>(A(),$("div",{class:"warehouse-canvas-game",onMousemove:Fe},[x("canvas",{ref_key:"canvasRef",ref:u,onClick:de,onContextmenu:Je(qe,["prevent"])},null,544),x("div",it,[x("h3",null,"🎖️ 等级："+k(oe(R).level),1),x("p",null,"经验值："+k(oe(R).exp)+" / "+k(se.value),1),x("div",rt,[x("div",{class:"level-bar-inner",style:we({width:Ce.value+"%"})},null,4)]),x("div",ct,"💰资金: ¥"+k(Q.value),1),x("div",ut,[(A(),$(V,null,J(ae,n=>x("button",{key:n,onClick:l=>E.value=n,class:ke({active:E.value===n})},k(n),11,dt)),64))]),x("div",ft,[E.value==="入库"?(A(),$("div",vt,[(A(!0),$(V,null,J(oe(N),(n,l)=>(A(),$("div",{key:n.id,class:"product-entry"},[l<=oe(R).level+1?(A(),$("div",pt,[x("span",{class:"emoji",title:he(n.name)},k(n.emoji),9,mt),x("span",gt,k(n.name),1),x("span",ht,k(n.boxSize)+"个/箱",1),x("button",{class:"price-btn",onClick:a=>Re(n.id)},"¥"+k(n.boxSize*n.buyPrice),9,yt)])):(A(),$("div",xt," 🔒 "+k(n.name)+"（Lv."+k(l-2)+" 解锁） ",1))]))),128))])):ie("",!0),E.value==="出库"?(A(),$("div",bt,[(A(!0),$(V,null,J(L.value,n=>(A(),$("div",{key:n.id,class:"order-card"},[x("div",_t,[x("span",null,"🧾 订单 "+k(n.id),1)]),x("div",Tt,[(A(!0),$(V,null,J(n.items,l=>(A(),$("div",{key:l.productId,class:"order-item"},[x("span",null,k(ee(l.productId).emoji)+k(ee(l.productId).name),1),x("span",null,"¥ "+k(ee(l.productId).sellPrice),1),x("span",null,"× "+k(l.count),1)]))),128))]),x("div",wt,"🎁 奖金: ¥"+k(me(n)),1),x("div",kt,"💵 总收入: ¥"+k($e(n)),1),x("button",{class:"complete-btn",onClick:l=>Xe(n)},"    完成    ",8,St),x("div",Pt,[x("div",{class:"progress-fill",style:we({width:Ae(n)+"%"})},null,4)])]))),128))])):ie("",!0),E.value==="库存"?(A(),$("div",Mt,[(A(!0),$(V,null,J(ge.value,(n,l)=>(A(),$("div",{key:l,class:"stock-line"},[x("div",{class:"emoji-wrapper",title:he(n.name)},[x("span",Ct,k(n.emoji),1),x("span",jt,"×"+k(n.count),1)],8,It),x("span",Nt,k(n.name),1),x("span",$t,"估值: ¥"+k(n.value),1)]))),128)),x("div",At," 💰 总估值: ¥"+k(ze.value),1)])):ie("",!0),E.value==="技能"?(A(),$("div",zt,[(A(),$(V,null,J(K,n=>x("div",{key:n.id,class:ke(["skill-entry",{unlocked:W.value.includes(n.id)}])},[x("div",Dt,[x("span",Rt,k(n.name),1),x("span",Bt,k(n.description),1)]),x("button",{disabled:W.value.includes(n.id)||oe(O).money<n.cost,onClick:l=>Ne(n.id)},k(W.value.includes(n.id)?"已解锁":`购买 ¥${n.cost}`),9,Ot)],2)),64))])):ie("",!0)])])],32))}};export{Wt as default};
